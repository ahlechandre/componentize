/**
 * Componentize.js - A handler for register and upgrade components dynamically.
 * The design pattern is inspired (in parts) by the Google (MDL) componentHandler.
 * 
 * @author Alexandre Thebaldi <ahlechandre@gmail.com>
 * @version v0.1.0
 */
var Componentize=function(){var e=[],f=[],k=function(b){var c=document.querySelectorAll("."+b.cssClass),a;for(a=0;a<c.length;a++)h(c[a],b)},h=function(b,c){var a,d=[];b.classList.contains(c.cssClass)?(a=c.name,a=(d=b.getAttribute("data-upgraded-components"))?-1!==d.indexOf(a):!1,a||(d=m(b),d.push(c.name),a=new c.constructor(b),a.element=b,a._ComponentConfig=c,b[c.name]=a,b.setAttribute("data-upgraded-components",d.join(",")),f.push(a))):console.warn('The element does not contain the defined class "'+
c.cssClass+'"')},m=function(b){var c=[],a,d;b.classList.forEach(function(e){for(d=0;d<f.length;d++)a=f[d],-1===c.indexOf(a._ComponentConfig.name)&&a.element===b&&c.push(a._ComponentConfig.name)});return c},l=function(b){var c=null,a;for(a=0;a<e.length;a++)if(e[a].cssClass===b){c=e[a];break}return c},g=function(b,c){var a=b.getAttribute("data-upgraded-components").split(","),d=a.indexOf(c);if(-1!==d){a.splice(d,1);b.setAttribute("data-upgraded-components",a.join(","));for(d=0;d<f.length;d++)if(a=f[d],
a.element===b&&a._ComponentConfig.name===c){f.splice(d,1);break}delete b[c]}};return{register:function(b){var c={};if("undefined"===typeof b||"object"!==typeof b||"function"!==typeof b.constructor||"string"!==typeof b.name||!b.name.length||"string"!==typeof b.cssClass||!b.cssClass.length)throw Error("Please, provide a valid data config for component.");c.constructor=b.constructor;c.name=b.name;c.cssClass=b.cssClass;e.forEach(function(a){if(a.cssClass===c.cssClass)throw Error('The css class "'+c.cssClass+
'" is already registered.');});e.push(c)},upgradeElement:function(b,c){var a=[],d;b instanceof HTMLElement&&(a=b.classList,"string"===typeof c&&c.length?(d=l(c))&&h(b,d):a.forEach(function(a){(d=l(a))&&h(b,d)}))},upgrade:function(b){e.forEach(function(c){c.cssClass===b&&k(c)})},upgradeAll:function(){e.forEach(function(b){k(b)})},downgradeElement:function(b,c){var a=b.getAttribute("data-upgraded-components"),d=[];if(b instanceof HTMLElement)if("string"===typeof c&&c.length)for(a=0;a<e.length;a++){if(e[a].cssClass===
c){g(b,e[a].name);break}}else"string"!==typeof a||2>a.split(",")||(d=a.split(","),d.forEach(function(a){g(b,a)}))},downgrade:function(b){var c,a;if("string"===typeof b&&b.length){for(a=0;a<e.length;a++)if(e[a].cssClass===b){c=e[a].name;break}b=document.querySelectorAll("[data-upgraded-components*="+c+"]");for(a=0;a<b.length;a++)g(b[a],c)}},downgradeAll:function(){var b,c,a=f.length,d;for(d=0;d<a;d++)c=f[0],b=c._ComponentConfig.name,g(c.element,b)},getAllRegistered:function(){return e},getAllCreated:function(){return f}}}();
window.Componentize=Componentize;window.addEventListener("load",function(){Componentize.upgradeAll()});